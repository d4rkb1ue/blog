<!doctype html>
<html lang="en">
<head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content='text/html; charset=utf-8' http-equiv='content-type' />

  <title>私有翻墙服务搭建指南 - d4rkb1ue&#39;s Blog</title>
  <meta content='私有翻墙服务搭建指南 - d4rkb1ue&#39;s Blog' property='title' />
  <meta content='私有翻墙服务搭建指南 - d4rkb1ue&#39;s Blog' property='og:title' />


<meta property="og:description" content="简介  如何购买服务器？ 如何配置服务器？ 在 Mac, Windows, iOS, Android 设备上通过配置好的服务器翻墙 高级玩法  购买 VPS  费用：以下两家服务商提供的最低配价格都是$5/月*；如果使用快照服务，DigitalOcean 收取极少量费用，Vultr 免费。  服务商推荐  DigitalOcean $10 优惠: DigitalOcean 的新加坡, 旧金山, 纽约服务器都还可以。 Vultr 限时 $20 优惠, Vultr $10 优惠: Vultr 的日本东京服务器速度飞快！ 阿里云国际, 推荐香港。CN2 线路, 当前最优选择。  注：通过以上链接注册，在你将获得优惠的同时，作者也将获得相应的推广回报。使用以下链接可以避免给作者回报 http://digitalocean.com/，http://www.vultr.com/
使用 DigitalOcean  测速地址 懒人推荐：SGP1, SFO2, NYC1  流程  点击 Create Droplets Image 选择 Ubuntu 16.04.x x64 Size 选择最低的$5版本即可 Datacenter Region 选择刚刚选好的那个服务器 （*按需）SSH keys, New SSH key, 输入." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://drkbl.com/posts/fanqiang-guide/" />


<meta property="article:published_time" content="2017-01-04T16:38:37&#43;00:00"/>

<meta property="article:modified_time" content="2017-01-04T16:38:37&#43;00:00"/>








<meta name="generator" content="Hugo 0.80.0" />

<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" rel="stylesheet">
<style type="text/css">/*https://coolors.co/afd5aa-f0f2ef-a69f98-3d3d3d-8c6057*/
:root {
  --main-color: #8C6056; 
  --secondary-color: #AFD5AA;
  --logo-text-color: #fff;
  --body-text-color: #3d3d3d;
  --heading-text-color: #383838;
  --background-color: #fff;
}</style>
<link href='/css/tachyons.min.css' rel="stylesheet">
<link href='/css/styles.css' rel="stylesheet">


<link rel="icon" 
 
  href='/favicon.ico'

type="image/x-icon"/>

<link href='/feed.xml' rel="alternate" type="application/atom+xml" title="d4rkb1ue&#39;s Blog" />

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-74825078-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
</head>
<body class="global-font">
  <nav class=" justify-between border-box pa3 pl3-l pr2-l mt1 mt0-ns" id="navbar">
  <div class="flex">
    <a class="f4 fw6 ttu no-underline dim bg-main-color pv1 ph2 br2" id="site-title" href='/' title="Home">d4rkb1ue&#39;s Blog</a>
  </div>
  
</nav>
  
<main class="center mv4 content-width ph3">
  <div class="f3 fw6 heading-color heading-font post-title">私有翻墙服务搭建指南</div>
  <p class="silver f6 mt1 mb4 post-meta">
    <time>04 Jan 2017</time> 
     | 
    
    
    tags: [ <a href='/tags/tools' class="link silver">Tools</a> <a href='/tags/proxy' class="link silver">Proxy</a>  ]
    
  </p>
  <div class="lh-copy post-content"><h1 id="简介">简介</h1>
<ul>
<li>如何购买服务器？</li>
<li>如何配置服务器？</li>
<li>在 Mac, Windows, iOS, Android 设备上通过配置好的服务器翻墙</li>
<li>高级玩法</li>
</ul>
<h1 id="购买-vps">购买 VPS</h1>
<ul>
<li>费用：以下两家服务商提供的最低配价格都是$5/月*；如果使用快照服务，DigitalOcean 收取极少量费用，Vultr 免费。</li>
</ul>
<h2 id="服务商推荐">服务商推荐</h2>
<ul>
<li><a href="https://m.do.co/c/93c5105aab61">DigitalOcean $10 优惠</a>: DigitalOcean 的新加坡, 旧金山, 纽约服务器都还可以。</li>
<li><a href="http://www.vultr.com/?ref=7076061-3B">Vultr 限时 $20 优惠</a>, <a href="http://www.vultr.com/?ref=7076060">Vultr $10 优惠</a>: Vultr 的日本东京服务器速度飞快！</li>
<li><a href="https://sp-buy-intl.aliyun.com/simple">阿里云国际</a>, 推荐香港。<strong>CN2 线路, 当前最优选择</strong>。</li>
</ul>
<p><em>注：通过以上链接注册，在你将获得优惠的同时，作者也将获得相应的推广回报。使用以下链接可以避免给作者回报 <code>http://digitalocean.com/</code>，<code>http://www.vultr.com/</code></em></p>
<h2 id="使用-digitalocean">使用 DigitalOcean</h2>
<ul>
<li><a href="http://speedtest-sfo1.digitalocean.com">测速地址</a></li>
<li>懒人推荐：SGP1, SFO2, NYC1</li>
</ul>
<h3 id="流程">流程</h3>
<ol>
<li>点击 Create Droplets</li>
<li>Image 选择 Ubuntu 16.04.x x64</li>
<li>Size 选择最低的$5版本即可</li>
<li>Datacenter Region 选择刚刚选好的那个服务器</li>
<li>（*按需）SSH keys, <code>New SSH key</code>, 输入<code>.ssh/id_rsa.pub</code>中的内容，格式大约是：<code>ssh-rsa AAAA...Bjjdwd d4rkb1ue@drkbl.com</code></li>
<li>Create!</li>
<li>等待进度条走完，就可以看到 IP 地址了，如<code>138.197.84.40</code></li>
</ol>
<h2 id="使用-vultr">使用 Vultr</h2>
<ul>
<li><a href="https://www.vultr.com/faq/#downloadspeedtests">测速地址</a></li>
<li>懒人推荐：Tokyo</li>
</ul>
<p><em>流程类似。不赘述。</em></p>
<h2 id="使用阿里云">使用阿里云</h2>
<ol>
<li>使用 <a href="https://sp-buy-intl.aliyun.com/simple">此链接</a> 创建一个 ECS 服务器</li>
<li>进入 Consol 控制台 -&gt; Elastic Compute Service, 可以看到刚刚创建的 instance 实例</li>
<li>在侧边栏选择 Networks and Security -&gt; SSH Key Pair</li>
<li>Create SSH Key Pair, 选择 Import SSH Key Pair, 输入本地电脑 <code>.ssh/id_rsa.pub</code> 中的内容，格式大约是: <code>ssh-rsa AAAA...Bjjdwd d4rkb1ue@drkbl.com</code></li>
<li>OK 创建。将这个 key bind 绑定到刚刚创建的 instance</li>
<li>在 instance 的 action 中选择 more -&gt; Netword and security group -&gt; Configure</li>
<li>Add Rules -&gt; 增加一条 ingress, allow, customized TCP, port range=<code>8388/8388</code>(或者你的 SS 服务端口), Authorization Objects=<code>0.0.0.0/0</code></li>
<li>重启 instance</li>
<li>可供访问的 IP 是 Internet IP</li>
</ol>
<h1 id="服务端安装">服务端安装</h1>
<h2 id="登入远程服务器">登入远程服务器</h2>
<p>在 Mac 上操作, <code>138.197.84.40</code> 需要替换为你的 IP,</p>
<pre><code>ssh root@138.197.84.40
</code></pre><p>出现诸如 <code>Do you want/Are you sure to xxx? [Y/n]</code> 输入 <code>Y</code> 或者yes，回车</p>
<!-- raw HTML omitted -->
<h2 id="安装-shadowsocks">安装 Shadowsocks</h2>
<ol>
<li>
<p>安装程序</p>
<pre><code>sudo apt-get update
sudo apt-get install python-pip
sudo pip install shadowsocks
</code></pre></li>
<li>
<p>新建配置</p>
<pre><code>nano /etc/shadowsocks.json
</code></pre></li>
<li>
<p>编辑配置文件</p>
<p>将下面的代码复制粘贴。其中，<code>server_port</code>, <code>password</code>, <code>method</code> 可自定义。输入完毕按<code>Ctrl+x</code>，再按y保存。</p>
<pre><code>{
    &quot;server&quot;:&quot;0.0.0.0&quot;,
    &quot;server_port&quot;:8388,
    &quot;local_address&quot;: &quot;127.0.0.1&quot;,
    &quot;local_port&quot;:1080,
    &quot;password&quot;:&quot;yourpassword&quot;,
    &quot;timeout&quot;:300,
    &quot;method&quot;:&quot;aes-256-cfb&quot;,
    &quot;fast_open&quot;: false,
    &quot;workers&quot;: 1
}
</code></pre></li>
<li>
<p>启动服务</p>
<pre><code>ssserver -c /etc/shadowsocks.json -d start
</code></pre></li>
<li>
<p>（*按需）关闭服务</p>
<pre><code>ssserver -c /etc/shadowsocks.json -d stop
</code></pre></li>
</ol>
<h1 id="在终端上通过配置好的服务器翻墙">在终端上通过配置好的服务器翻墙</h1>
<h2 id="macos">macOS</h2>
<ul>
<li><a href="https://github.com/shadowsocks/shadowsocks-iOS/wiki/Shadowsocks-for-OSX-%E5%B8%AE%E5%8A%A9">Shadowsocks-for-OSX</a> 需要手动切换 branch 到 <code>master</code> 才能看到 release 版本</li>
<li><a href="https://sourceforge.net/projects/shadowsocksgui/">Shadowsocks-for-OSX@sourceforce</a></li>
</ul>
<h2 id="iphone">iPhone</h2>
<ul>
<li><a href="https://itunes.apple.com/cn/app/shadowrocket/id932747118?mt=8">Shadowrocket</a></li>
<li><a href="https://itunes.apple.com/us/app/surge-web-developer-tool-and-proxy-utility/id1040100637?mt=8">Surge</a></li>
</ul>
<h2 id="surge-配置">Surge 配置</h2>
<p>打开 Surge App
选择 从 URL 下载配置，输入</p>
<pre><code>https://raw.githubusercontent.com/d4rkb1ue/SurgeConfig/master/Shadowsocks.conf
</code></pre><p>编辑 Shadowsocks.conf，将 <code>#Shadowsocks Server IP#</code>, <code>#Shadowsocks Server Port#</code>, <code>#password#</code> 替换为<code>你的 VPS IP</code>, <code>端口 port 上面示例是 8388</code>, <code>你的密码</code>（替换整体，包括<code>#</code>号）
开始此配置。</p>
<p><a href="https://github.com/d4rkb1ue/SurgeConfig">https://github.com/d4rkb1ue/SurgeConfig</a></p>
<h2 id="解决-shadowsocks-for-osx-更新-gfwlist自定义规则发生错误">解决 Shadowsocks for osx 更新 gfwlist（自定义规则）发生错误</h2>
<p>新建 update_gfwlist.sh，复制粘贴以下：</p>
<pre><code>#!/bin/bash
# update_gfwlist.sh
# Author : VincentSit
# Copyright (c) http://xuexuefeng.com

GFWLIST=&quot;https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt&quot;
PROXY=&quot;127.0.0.1:1080&quot;
USER_RULE_NAME=&quot;user-rule.txt&quot;

check_module_installed()
{
    pip list | grep gfwlist2pac &amp;&gt; /dev/null

    if [ $? -eq 1 ]; then
        echo &quot;Installing gfwlist2pac.&quot;

        pip install gfwlist2pac
    fi
}

update_gfwlist()
{
    echo &quot;Downloading gfwlist.&quot;

    curl -s &quot;$GFWLIST&quot; --fail --socks5-hostname &quot;$PROXY&quot; --output /tmp/gfwlist.txt

    if [[ $? -ne 0 ]]; then
        echo &quot;abort due to error occurred.&quot;
    exit 1
    fi

    cd /Users/$(logname)/.ShadowsocksX || exit 1

    if [ -f &quot;gfwlist.js&quot; ]; then
        mv gfwlist.js ~/.Trash
    fi

    if [ ! -f $USER_RULE_NAME ]; then
        touch $USER_RULE_NAME
    fi

    /usr/local/bin/gfwlist2pac \
    --input /tmp/gfwlist.txt \
    --file gfwlist.js \
    --proxy &quot;SOCKS5 $PROXY; SOCKS $PROXY; DIRECT&quot; \
    --user-rule $USER_RULE_NAME \
    --precise

  rm -f /tmp/gfwlist.txt

  echo &quot;Updated.&quot;
}

check_module_installed
update_gfwlist
</code></pre><p>保存。</p>
<p>修改权限：<code>chmod +x update_gfwlist.sh</code></p>
<p>修改 “user-rule.txt” 之后，执行 <code>sudo ./update_gfwlist.sh</code></p>
<p>（在 “user-rule.txt” 尾部添加1行<code>example.com</code>即可加入 <code>*.example.com/*</code> 的 Proxy 规则，如：</p>
<pre><code>! Put user rules line by line in this file.
! See https://adblockplus.org/en/filter-cheatsheet
digitalocean.com
googletagmanager.com
</code></pre><p>)</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<hr>
<h1 id="高级技巧">高级技巧</h1>
<h2 id="使用rsync来同步文件">使用<code>rsync</code>来同步文件</h2>
<p>每次都<code>nano</code>一个新文件，但是在命令行做文本编辑很不舒服。对于不想学习vim的同学来说，在本地用sublime，vscode等一众舒适的文本编辑器编辑好了再同步到远程是一个不错的方式。以同步shadowsocks的conf配置文件举例，在本地<code>~/shadowsocks.json</code>编辑好文件后，输入</p>
<pre><code>rsync --delete --rsh=ssh -av ~/shadowsocks.json root@138.197.84.40:/etc/shadowsocks.json
</code></pre><p>即可同步到远程<code>/etc/shadowsocks.json</code>处。</p>
<ul>
<li><code>--delete</code>: 如果目的地有同名文件，则删除</li>
<li><code>-a</code>: achieve 模式</li>
<li><code>-v</code>: 反馈可见。上传成功与否会显示出结果</li>
<li><code>--rsh=ssh</code>: 登陆远程服务器模式，可以在后面加入密码，端口什么的</li>
</ul>
<h2 id="为服务器产生快照">为服务器产生快照</h2>
<h3 id="digitalocean">DigitalOcean</h3>
<ol>
<li>进入 Image</li>
<li>Take a Snapshot，选择做好的那个服务器，自定义名字</li>
<li>点击 Take Snapshot</li>
<li>调整 Snapshot 的位置：在做好的 Snapshot 上点击 More，选择 Add to region， 移动到你想要的地方</li>
<li>使用做好的 Snapshot 新建服务器（服务器所在地要有这个 Snapshot，执行第4步来添加存储位置）：Create Droplots 时，在 Choose an image 中选择 Snapshot 选项卡，选择你想要的 Snapshots，而不是选择 Ubuntu</li>
</ol>
<h3 id="vultr">Vultr</h3>
<ol>
<li>选择做好的 Server</li>
<li>点击 Snapshot</li>
<li>输入 label，点击 Take a Snapshot</li>
<li>Vultr 制造新的 Snapshot 需要1个小时，这个体验真的不好</li>
</ol>
<h2 id="使用-systemctl-建立系统服务自动托管">使用 systemctl 建立系统服务自动托管</h2>
<p>好处:</p>
<ul>
<li>重启后可以自启动</li>
<li>保存为 Snapshot 快照后可以快速建立，自动启动，免除一切服务端配置，便于迅速更换 IP</li>
</ul>
<p>要建立 Linux 系统服务，在 SS 服务器新建文件</p>
<pre><code>/etc/systemd/system/shadowsocks.service
</code></pre><p>复制粘贴以下内容</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
Description<span style="color:#f92672">=</span>Shadowsocks
After<span style="color:#f92672">=</span>network.target

<span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
ExecStart<span style="color:#f92672">=</span>/usr/bin/python /usr/local/bin/ssserver -c /etc/shadowsocks.json start
ExecReload<span style="color:#f92672">=</span>/bin/kill -9 $MAINPID
Restart<span style="color:#f92672">=</span>always
RestartSec<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>

<span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
WantedBy<span style="color:#f92672">=</span>multi-user.target
</code></pre></div><p>注意在 command 行没有 <code>-d</code> ，因为<code>-d</code>是 shadowsocks 运行为 daemon，后台程序的参数。我们需要 supervisor 来监控 shadowsocks ，所以不要运行为后台程序。
完成保存退出。</p>
<p>如果 shadowsocks 已经在运行了，需要先执行</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ssserver -c /etc/shadowsocks.json -d stop
</code></pre></div><p>开启服务。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo systemctl reenable shadowsocks.service
sudo systemctl restart shadowsocks.service

<span style="color:#75715e"># 查看服务状态</span>
sudo systemctl status shadowsocks.service
<span style="color:#75715e"># (如需)中止服务</span>
sudo systemctl stop shadowsocks.service
</code></pre></div><p><em>如果发生问题，尝试重启。</em></p>
<h1 id="加速">加速</h1>
<p><a href="https://github.com/iMeiji/shadowsocks_install/wiki/">https://github.com/iMeiji/shadowsocks_install/wiki/</a>开启TCP-BBR拥塞控制算法</p>
</div>
</main>
 






<div class="tl fixed list-pages lh-copy" id="contents-list"></div>



<div class="pagination tc tr-l db fixed-l bottom-2-l right-2-l mb3 mb0-l">
  
<a id="scroll-to-top" class="f6 o-0 link br2 ph2 pv1 mb1 bg-main-color pointer" onclick="topFunction()" style="color: #fff; visibility: hidden; display: none; transition: opacity .5s, visibility .5s;" title="back to top">back to top</a>
<br>
  <p class="mb0 mt2">
  <a href="https://drkbl.com/posts/download-single-file-from-github/">prev post</a>
  <a href="https://drkbl.com/posts/use-numbers-vlook-function-match-gpa/">next post</a>
  </p>
</div>

  <footer class="content-width mt0 mt5-l mb4 f6 center ph3 gray tc tl-l">
  <hr class="dn db-l ml0-l gray w3"><br>
  Powered by <a href="https://gohugo.io/" target="_blank" class="link gray dim">Hugo</a>, based on the <a href="https://github.com/lingxz/er" target="_blank" class="link gray dim">Er</a> theme. <br>
  Contact me at 7874364@gmail.com
</footer>
  



<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<style>.is-active-link::before { background-color: var(--secondary-color); }</style>




<script type="text/javascript">
var prevScrollpos = window.pageYOffset;
window.onscroll = function() {
  var currentScrollPos = window.pageYOffset;

  
  if (document.getElementById("tag-cloud") !== null) { 
    if (prevScrollpos > currentScrollPos) { 
      document.getElementById("tag-cloud").style.visibility = "visible";
      document.getElementById("tag-cloud").style.opacity = "1";
    } else {
      document.getElementById("tag-cloud").style.visibility = "hidden";
      document.getElementById("tag-cloud").style.opacity = "0";
    }
  }
  

  
  if (document.body.scrollTop > 1000 || document.documentElement.scrollTop > 1000) {
      document.getElementById("scroll-to-top").style.display = "inline";
      document.getElementById("scroll-to-top").style.visibility = "visible";
      document.getElementById("scroll-to-top").style.opacity = "1";
  } else {
      document.getElementById("scroll-to-top").style.visibility = "hidden";
      document.getElementById("scroll-to-top").style.opacity = "0";
  }
  
  prevScrollpos = currentScrollPos;
}


function topFunction() {
  document.body.scrollTop = 0; 
  document.documentElement.scrollTop = 0; 
}






if (document.getElementById("contents-list") !== null && document.getElementsByClassName("post-content").length !== 0) { 
  tocbot.init({
    
    tocSelector: '#contents-list',
    
    contentSelector: '.post-content',
    
    headingSelector: 'h1, h2, h3',
  });
}


</script>




</body>
</html>